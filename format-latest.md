# Snail Log Format Specification
***Current Format Version: 0.0.1-beta***

A snail log is generated by Snail Tracer and presented to Snail Explorer in JSON format. 
The file placed as format-latest.md in repository root folder describes the current file 
format while format-***version*** in format directory describes the legacy formats.

- [Root Entity](#root-entity)
- [Object Entity](#object-entity)
- [Footprint Entity](#footprint-entity)

## Root Entity

The root of the snail log is presented as below:

```json
{
    "version": "0.0.1-beta",       // The current version of snail log.
    "root": "<root>",              // (Optional) JSON string of the root directory to search 
                                   // the source files. Snail Explorer will search for the 
                                   // current working directory if this field is abscent.
    "files": ["<sourceFile>"...],  // Array of JSON strings, which is the path (either 
                                   // absolute or relative, and the root will be used if 
                                   // it is relative) of source files, will be referred by 
                                   // the follwed footprints with array index.
    "functions": ["<names>"...],   // Array of JSON strings, which is the display names of 
                                   // current executing functions, will be referred by the 
                                   // followed footprints with array index.
    "objects": [<object>...],      // Array of JSON objects, which is the runtime captures  
                                   // of objects, will be referred by the follwed program 
                                   // footprints. For details of objects' format, see also 
                                   // the Object Entity section.
    "footprints": [<footprint>...] // Array of JSON objects, which is the runtime captures 
                                   // of stack frames (including stacktrace and supervised 
                                   // objects). The footprint is presented in explorer. For
                                   // details of footprints' format, see also the Footprint
                                   // Entity section.
}
```

# Object Entity

A generic representation of the objects in snail log is presented as below:
```json
{
    "trait": "<objectTrait>",      // The trait telling the explorer how to treat the 
                                   // object, like treating it as a flat object directly, 
                                   // or displaying it as a structured object (the user 
                                   // can fold or collapse objects as they desire), etc.
    "type": "<objectType>",        // The displayed type of the object. The type just serves
                                   // as an eye candy and will not affect the runtime 
                                   // behavior of object.
    "data": <objectData>,          // The actual data of the object, but how will the Snail 
                                   // Explorer treat the data depends on the trait.
    ...                            // Some extra fields depending on the traits.
}
```

For objects which is desired to be presented to user directly, the object will looks like:
```json
{
    "trait": "literal",
    "type": "<objectType>",
    "data": <dataInJson>,          // The data which are literals will be very likely to be
                                   // JSON-serialized and printed out to user.
}
```

For objects which have field(s) and is desired to be expanded or collapsed (usually complex 
structures) while exploring, the object will looks like:
```
{
    "trait": "struct",
    "type": "<objectType>",
    "data": {
        "<field>": <fieldObject>,  // The map from the object field name to its value, the 
        ...                        // value might be another struct and forms a hierarchy.
    }
}
```

# Footprint Entity

A foot print is presented in tree structure, the format is presented as below:
```json
{
    "parent": <parentIndex>,       // (Optional) The parent index of this footprint entity, 
                                   // usually the caller function's footprint. If it is
                                   // abscent, it indicates the root of the footprint.
    "file": <fileIndex>,           // (Optional) The index to the source file. If it is 
                                   // abscent, the source file is considered abscent.
    "line": <lineNo>,              // (Optional) If file is present, this item must also 
                                   // present and indicates current executing line of code.
    "function": <funcIndex>,       // (Optional) The index of current executing function.
    "objects": {
        "<scope>": {
            "<name>": <object>,    // The map from the name to index of an object.
            ...
        }...                       // The scope (local, args, etc.) of the captured objects.
    }                              // The objects partitioned by scopes.
}
```
